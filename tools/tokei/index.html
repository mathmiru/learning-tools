<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SYSTEM_CLOCK_FIXED</title>
    <script src="https://cdn.jsdelivr.net/gh/phi-jp/phina.js@v0.2.3/build/phina.js"></script>
    <style>body{margin:0;background:#fdfdfd;overflow:hidden;display:flex;justify-content:center;align-items:center;height:100vh}canvas{max-width:100%;max-height:100%;object-fit:contain}</style>
</head>
<body>
<script>
(function(){
    // 難読化キーワード配列
    const _0xK = ['Z2xvYmFsaXpl','ZGVmaW5l','TWFpblNjZW5l','RGlzcGxheVNjZW5l','Q2lyY2xlU2hhcGU=','UmVjdGFuZ2xlU2hhcGU=','c2V0UG9zaXRpb24=','YWRkQ2hpbGRUbw==','c2V0T3JpZ2lu','c2V0SW50ZXJhY3RpdmU=','cm90YXRpb24=','c3luY0RpZ2l0YWw='];
    const _0xG = (i) => atob(_0xK[i]);
    
    phina[_0xG(0)]();
    const _0xCalc = (a, b) => Math.atan2(b.y - a.y, b.x - a.x) * 180 / Math.PI + 90;

    phina[_0xG(1)](_0xG(2), {
        superClass: _0xG(3),
        init: function() {
            const _t = this;
            _t.superInit({width: 640, height: 960});
            _t.backgroundColor = '#ffffff';

            const _cGrp = phina.display.DisplayElement()[_0xG(7)](_t)[_0xG(6)](320, 310);
            
            // 操作ガイド
            phina.display.Label({text:'青いはりをさわって うごかせるよ！', fontSize:24, fill:'#555', fontWeight:'bold', y:310})[_0xG(7)](_t)[_0xG(6)](320, 620);

            phina.display[_0xG(4)]({radius:240, fill:'#fff', stroke:'#2c3e50', strokeWidth:10})[_0xG(7)](_cGrp);

            for (let i = 0; i < 60; i++) {
                let b = i % 5 === 0, r = Math.degToRad(i * 6);
                phina.display[_0xG(5)]({width: b ? 6 : 2, height: b ? 20 : 10, fill: '#2c3e50'})
                    [_0xG(7)](_cGrp)[_0xG(6)](Math.sin(r) * 215, -Math.cos(r) * 215).rotation = i * 6;
            }

            _t.hg = phina.display.DisplayElement()[_0xG(7)](_cGrp);
            for (let i = 1; i <= 12; i++) {
                let r = Math.degToRad(i * 30);
                phina.display.Label({text: (i * 5).toString(), fontSize: 24, fill: '#3498db', x: Math.sin(r) * 275, y: -Math.cos(r) * 275})[_0xG(7)](_t.hg);
            }
            _t.hg.visible = false;

            for (let i = 1; i <= 12; i++) {
                let r = Math.degToRad(i * 30);
                phina.display.Label({text: i.toString(), fontSize: 55, fill: '#2c3e50', fontWeight: 'bold', x: Math.sin(r) * 170, y: -Math.cos(r) * 170})[_0xG(7)](_cGrp);
            }

            _t.hh = phina.display[_0xG(5)]({width: 22, height: 160, fill: '#e74c3c', stroke: '#c0392b', strokeWidth: 2, cornerRadius: 10})[_0xG(7)](_cGrp)[_0xG(8)](0.5, 0.85);
            _t.mh = phina.display[_0xG(5)]({width: 14, height: 230, fill: '#3498db', stroke: '#2980b9', strokeWidth: 2, cornerRadius: 7})[_0xG(7)](_cGrp)[_0xG(8)](0.5, 0.9);
            
            _t.hh[_0xG(9)](false);
            _t.mh[_0xG(9)](true);

            _t.dw = phina.display[_0xG(5)]({width: 180, height: 70, fill: '#ecf0f1', stroke: '#bdc3c7', strokeWidth: 2, cornerRadius: 10, y: 90})[_0xG(7)](_cGrp);
            _t.dl = phina.display.Label({text: '12:00', fontSize: 50, fill: '#2c3e50', fontWeight: 'bold'})[_0xG(7)](_t.dw);
            _t.dw.visible = false;

            _t.mh.onpointmove = function(e) {
                let o = this[_0xG(10)], n = _0xCalc(_cGrp, e.pointer);
                this[_0xG(10)] = n;
                let d = n - o;
                if (d > 180) d -= 360;
                if (d < -180) d += 360;
                _t.hh[_0xG(10)] += d / 12;
                _t[_0xG(11)]();
            };

            phina.display[_0xG(4)]({radius: 15, fill: '#2c3e50'})[_0xG(7)](_cGrp);

            const _bGrp = phina.display.DisplayElement()[_0xG(7)](_t)[_0xG(6)](320, 780);
            const _bSty = { width: 160, height: 85, fontSize: 24, cornerRadius: 10, fill: '#fff', stroke: '#2c3e50', strokeWidth: 3, fontColor: '#2c3e50' };

            const _cfg = [
                {l:'＋1じかん', v:60, x:-200, y:-100}, {l:'＋10ふん', v:10, x:0, y:-100}, {l:'＋1ふん', v:1, x:200, y:-100},
                {l:'－1じかん', v:-60, x:-200, y:10}, {l:'－10ふん', v:-10, x:0, y:10}, {l:'－1ふん', v:-1, x:200, y:10}
            ];

            _cfg.forEach(b => {
                phina.ui.Button({..._bSty, text: b.l})[_0xG(7)](_bGrp)[_0xG(6)](b.x, b.y).on('push', () => {
                    _t.mh[_0xG(10)] += b.v * 6;
                    _t.hh[_0xG(10)] += b.v * 0.5;
                    _t[_0xG(11)]();
                });
            });

            phina.ui.Button({..._bSty, text:'デジタル', width: 140})[_0xG(7)](_bGrp)[_0xG(6)](-230, 120).on('push', () => _t.dw.visible = !_t.dw.visible);
            phina.ui.Button({..._bSty, text:'いま', width: 100})[_0xG(7)](_bGrp)[_0xG(6)](-100, 120).on('push', () => _t.setNow());
            phina.ui.Button({..._bSty, text:'リセット', width: 130})[_0xG(7)](_bGrp)[_0xG(6)](25, 120).on('push', () => { _t.hh[_0xG(10)]=_t.mh[_0xG(10)]=0; _t[_0xG(11)](); });
            _t.hb = phina.ui.Button({..._bSty, text:'ヒント:OFF', width: 160})[_0xG(7)](_bGrp)[_0xG(6)](185, 120).on('push', function() {
                _t.hg.visible = !_t.hg.visible;
                this.text = _t.hg.visible ? "ヒント:ON" : "ヒント:OFF";
            });

            _t[_0xG(11)]();
        },
        setNow: function() {
            const d = new Date(), m = d.getMinutes(), h = d.getHours() % 12;
            this.mh[_0xG(10)] = m * 6;
            this.hh[_0xG(10)] = h * 30 + m * 0.5;
            this[_0xG(11)]();
        },
        syncDigital: function() {
            let m = Math.round(((this.mh[_0xG(10)] % 360 + 360) % 360) / 6);
            if (m === 60) m = 0;
            let h = Math.floor(((this.hh[_0xG(10)] % 360 + 360) % 360) / 30);
            if (h === 0) h = 12;
            this.dl.text = h + ":" + (m < 10 ? "0" + m : m);
        }
    });

    phina.main(() => {
        phina.game.GameApp({startLabel:'main', width:640, height:960}).run();
    });
})();
</script>
</body>
</html>
