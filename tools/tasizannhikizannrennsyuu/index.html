<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Math Challenge</title>
    <style>body{font-family:"Hiragino Maru Gothic ProN",sans-serif;background:linear-gradient(#f5fbff,#e0f2ff);text-align:center;margin:0;padding:10px}h1{color:#ff7a00;font-size:1.8em;margin:10px 0}.card{background:#fff;border-radius:24px;box-shadow:0 6px 12px rgba(0,0,0,.15);padding:20px;max-width:420px;margin:auto;position:relative;min-height:400px}.question{font-size:2.6em;margin:15px 0}input{font-size:2em;width:120px;text-align:center;border-radius:12px;border:2px solid #ccc;margin-bottom:15px}button,select{font-size:1.2em;margin:6px;padding:10px 18px;border-radius:20px;border:none;cursor:pointer}.btn-submit{background:#4cafef;color:#fff;width:80%;font-weight:700;box-shadow:0 4px #2a87c5}.btn-submit:active{box-shadow:none;transform:translateY(4px)}.btn-start{background:#ff7a00;color:#fff;font-size:1.5em;padding:20px 40px;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);z-index:10;width:80%;box-shadow:0 6px #d35400}.btn-reset{background:#999;color:#fff;font-size:.9em;margin-top:30px;padding:8px 15px}.result{font-size:1.4em;height:1.6em;margin-top:10px;font-weight:700}.status{margin-top:10px;font-size:1.1em}.bear{font-size:3.5em;margin:10px 0}.growth{font-size:.85em;margin-bottom:10px}.stages span{opacity:.3;font-weight:700;margin:0 2px}.stages .active{opacity:1;color:#ff7a00;font-size:1.2em}.bar{background:#eee;border-radius:10px;height:16px;margin-top:8px;overflow:hidden;border:1px solid #ddd}.bar-inner{height:100%;width:0;background:linear-gradient(90deg,#ffd54f,#ff8a65);transition:width .4s ease-out}.hidden{display:none}</style>
</head>
<body>
    <h1 id="x_h1"></h1>
    <div class="card">
        <button id="s_btn" class="btn-start"></button>
        <div id="g_a">
            <div>
                <select id="op_s"></select>
                <select id="gr_s"></select>
            </div>
            <div class="bear" id="b_i">ðŸ¥š</div>
            <div class="growth">
                <div class="stages" id="st_l"></div>
                <div class="bar"><div class="bar-inner" id="b_in"></div></div>
            </div>
            <div class="question" id="qs">?</div>
            <input type="text" id="ans_i" inputmode="numeric" pattern="[0-9]*" placeholder="?">
            <br>
            <button id="sb_btn" class="btn-submit" onclick="window._ck()"></button>
            <div class="result" id="rs_d"></div>
            <div id="mdl_d" style="font-size: 1.3em;"></div>
        </div>
    </div>
    <div class="status" id="st_tx"></div>
    <button id="r_btn" class="btn-reset" onclick="window._rg()"></button>

<script>
(function(){
    const _d=document, _w=window, _M=Math, _ge='\x67\x65\x74\x45\x6c\x65\x6d\x65\x6e\x74\x42\x79\x49\x64', _ih='\x69\x6e\x6e\x65\x72\x48\x54\x4d\x4c', _tc='\x74\x65\x78\x74\x43\x6f\x6e\x74\x65\x6e\x74';
    let _a=1, _b=1, _cc=0, _tn=0, _st=0;

    const _u = {
        h1: '\u8db3\u3057\u7b97\u30fb\u5f15\u304d\u7b97\u0020\u7121\u9650\u30c1\u30e3\u30ec\u30f3\u30b8',
        st: '\u25b6\u0020\u306f\u3058\u3081\u308b\uff01',
        add: '\u8db3\u3057\u7b97',
        sub: '\u5f15\u304d\u7b97',
        g16: ['1\u5e74\u751f','2\u5e74\u751f','3\u5e74\u751f','4\u5e74\u751f','5\u5e74\u751f','6\u5e74\u751f'],
        subm: '\u3053\u305f\u3048\u308b',
        ok: '\u2b55\u0020\u305b\u3044\u304b\u3044\uff01',
        ng: '\u274c\u0020\u3053\u305f\u3048\u306f\u0020',
        err: '\u26a0\u0020\u3059\u3046\u3058\u3092\u0020\u3044\u308c\u3066\u306d',
        ren: '\u308c\u3093\u305e\u304f\u0020\u305b\u3044\u304b\u3044\uff01\u3059\u3054\u3044\uff01',
        rst: '\u6700\u521d\uff08\u3055\u3044\u3057\u3087\uff09\u304b\u3089\u0020\u3084\u308a\u306a\u304a\u3059',
        stx: '\u305b\u3044\u304b\u3044\uff1a<span id="c_c">0</span>\u0020\uff0f\u0020\u3082\u3093\u3060\u3044\uff1a<span id="t_c">0</span>',
        stgs: [['\ud83e\udd5a0~','s1'],['\ud83d\udc2310~','s2'],['\ud83d\udc2420~','s3'],['\ud83d\udc3b30~','s4'],['\ud83e\uddfb40','s5']]
    };

    // UIè¨­å®š
    _d[_ge]('x_h1')[_tc]=_u.h1; _d[_ge]('s_btn')[_tc]=_u.st; _d[_ge]('sb_btn')[_tc]=_u.subm; 
    _d[_ge]('r_btn')[_tc]=_u.rst; _d[_ge]('st_tx')[_ih]=_u.stx;

    const _ops=_d[_ge]('op_s'), _grs=_d[_ge]('gr_s');
    [['add',_u.add],['sub',_u.sub]].forEach(o=>{let e=_d.createElement('option');e.value=o[0];e[_tc]=o[1];_ops.appendChild(e)});
    _u.g16.forEach((g,i)=>{let e=_d.createElement('option');e.value=i+1;e[_tc]=g;_grs.appendChild(e)});

    const _sl=_d[_ge]('st_l');
    _u.stgs.forEach(s=>{let e=_d.createElement('span');e.id=s[1];e[_tc]=s[0];_sl.appendChild(e)});

    const _nq=()=>{
        const g=Number(_grs.value), op=_ops.value, lv={1:10,2:20,3:30,4:40,5:50,6:100}[g]||10;
        if(op==='add'){
            _a=_M.floor(_M.random()*lv)+1; _b=_M.floor(_M.random()*lv)+1;
            _d[_ge]('qs')[_tc]=`${_a} + ${_b} = ?`;
        }else{
            _a=_M.floor(_M.random()*lv)+1; _b=_M.floor(_M.random()*_a)+1;
            _d[_ge]('qs')[_tc]=`${_a} - ${_b} = ?`;
        }
        const i=_d[_ge]('ans_i');i.value='';i.focus();
    };

    _w._ck=()=>{
        const raw=_d[_ge]('ans_i').value, fix=raw.replace(/[\uff10-\uff19]/g,s=>String.fromCharCode(s.charCodeAt(0)-0xfee0)).trim();
        const ans=Number(fix), op=_ops.value, res=_d[_ge]('rs_d');
        if(fix===''||isNaN(ans)){res[_tc]=_u.err;return}
        _tn++;
        const cor=(op==='add')?(_a+_b):(_a-_b), is=(ans===cor);
        if(is){_cc++;_st++;res[_tc]=_u.ok;res.style.color='#ff4500'}
        else{_st=0;res[_tc]=_u.ng+cor;res.style.color='#555'}
        _d[_ge]('c_c')[_tc]=_cc;_d[_ge]('t_c')[_tc]=_tn;
        _ub();_um();setTimeout(_nq,800);
    };

    const _ub=()=>{
        const bar=_d[_ge]('b_in'), ids=['s1','s2','s3','s4','s5'];
        ids.forEach(id=>_d[_ge](id).classList.remove('active'));
        let p=(_st/40)*100; if(p>100)p=100; bar.style.width=p+'%';
        let icon='ðŸ¥š', act='s1';
        if(_st<10){icon='ðŸ¥š';act='s1'}else if(_st<20){icon='ðŸ£';act='s2'}
        else if(_st<30){icon='ðŸ¤';act='s3'}else if(_st<40){icon='ðŸ»';act='s4'}else{icon='ðŸ§¸';act='s5'}
        _d[_ge]('b_i')[_tc]=icon;_d[_ge](act).classList.add('active');
    };

    const _um=()=>{
        const m=_d[_ge]('mdl_d');
        m[_tc]=(_st>0&&_st%10===0)?`\ud83c\udfc5 ${_st}${_u.ren}`:(_st===0?'':'');
    };

    _w._rg=()=>{
        _cc=0;_tn=0;_st=0;
        _d[_ge]('c_c')[_tc]=0;_d[_ge]('t_c')[_tc]=0;
        _d[_ge]('rs_d')[_tc]='';_d[_ge]('mdl_d')[_tc]='';
        _ub();_nq();
    };

    _d[_ge]('s_btn').onclick=function(){this.classList.add('hidden');_w._rg()};
    _d[_ge]('ans_i').onkeydown=e=>{if(e.key==='Enter')_w._ck()};
    _ub();
})();
</script>
</body>
</html>
